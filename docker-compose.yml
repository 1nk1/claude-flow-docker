services:
  claude-flow:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: ${CONTAINER_NAME:-claude-flow-alpha}
    hostname: claude-flow

    volumes:
      # Internal project directory
      - ./project:/workspace/project

      # External projects (configured via .env)
      - ${EXTERNAL_PROJECT_1:-./project}:/workspace/external/project1
      - ${EXTERNAL_PROJECT_2:-./project}:/workspace/external/project2
      - ${EXTERNAL_PROJECT_3:-./project}:/workspace/external/project3

      # Desktop files (for quick file sharing)
      - ${DESKTOP_FILES_PATH:-~/Desktop}:/workspace/desktop:ro

      # Persistent storage
      - claude-flow-hive:/workspace/.hive-mind
      - claude-flow-swarm:/workspace/.swarm
      - claude-flow-memory:/workspace/memory
      - claude-flow-coordination:/workspace/coordination

      # Configuration
      - ./config/.claude:/workspace/.claude
      - ./lib:/workspace/lib

      # Logs
      - ./logs:/workspace/logs

    environment:
      - NODE_ENV=${NODE_ENV:-production}
      - CLAUDE_FLOW_HOME=/workspace
      - CLAUDE_FLOW_PROJECT=/workspace/project
      - CLAUDE_FLOW_LOG_LEVEL=${CLAUDE_FLOW_LOG_LEVEL:-info}
      - MCP_SERVER_MODE=stdio

    networks:
      - claude-flow-net

    deploy:
      resources:
        limits:
          cpus: "${CONTAINER_CPU_LIMIT:-2}"
          memory: "${CONTAINER_MEMORY_LIMIT:-4G}"
        reservations:
          cpus: "${CONTAINER_CPU_RESERVATION:-1}"
          memory: "${CONTAINER_MEMORY_RESERVATION:-2G}"

    restart: unless-stopped
    stdin_open: true
    tty: true

volumes:
  claude-flow-hive:
    name: claude-flow-hive
  claude-flow-swarm:
    name: claude-flow-swarm
  claude-flow-memory:
    name: claude-flow-memory
  claude-flow-coordination:
    name: claude-flow-coordination

networks:
  claude-flow-net:
    name: claude-flow-network
    driver: bridge
